<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Apoio ao Fomento por Otimização - SAFO</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Estilos customizados para melhorar a aparência */
        body {
            background-color: #f8f9fa;
        }
        .header-ime {
            /* Cor azul IME/Marinha (exemplo) */
            background-color: #004d99; 
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
            position: relative; 
        }
        .login-link {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-weight: bold;
            text-decoration: none;
            /* Garante que o link apareça acima do modal, se estiver aberto */
            z-index: 1051; 
        }
        .login-link:hover {
            color: #ccc;
        }
    </style>
</head>
<body>

    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="loginModalLabel">Acesso ao SAFO</h5>
                </div>
                <div class="modal-body">
                    <p>Para receber notificações automáticas sobre novos editais, faça login.</p>
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="inputEmail" class="form-label">E-mail</label>
                            <input type="email" class="form-control" id="inputEmail" placeholder="seu.nome@ime.br" required>
                        </div>
                        <div class="mb-3">
                            <label for="inputPassword" class="form-label">Senha</label>
                            <input type="password" class="form-control" id="inputPassword" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-secondary" onclick="continuarSemLogin()">Continuar sem Login</button>
                    <button type="button" class="btn btn-primary" onclick="fazerLogin()">Fazer Login</button>
                </div>
            </div>
        </div>
    </div>
    <header class="header-ime text-center">
        <a href="#" class="login-link" data-bs-toggle="modal" data-bs-target="#loginModal" id="headerLoginLink">Fazer Login</a>
        
        <h1>Sistema de Apoio ao Fomento por Otimização - SAFO</h1> 
        <p class="lead" id="usuarioInfo">Dr. João Silva | Usuário Associado</p>
    </header>

    <div class="container">
        <div class="row mb-4">
            <div class="col-md-8">
                <div class="card p-3 shadow-sm">
                    <label for="selectLinha" class="form-label fs-5">
                        **1. Selecione Sua Linha de Pesquisa (Programas de Pós-Graduação)**
                    </label>
                    <select id="selectLinha" class="form-select form-select-lg" onchange="carregarEditais()">
                        <option value="">-- Escolha uma Linha de Pesquisa --</option>
                        <option value="cartografica">Programa de Engenharia Cartográfica</option>
                        <option value="defesa">Programa de Engenharia de Defesa</option>
                        <option value="eletrica">Programa de Engenharia Elétrica</option>
                        <option value="mecanica">Programa de Engenharia Mecânica</option>
                        <option value="nuclear">Programa de Engenharia Nuclear</option>
                        <option value="transportes">Programa de Engenharia de Transportes</option>
                        <option value="materiais">Programa de Pós-Graduação em Ciência e Engenharia de Materiais</option>
                        <option value="quimica">Programa de Engenharia Química</option>
                        <option value="sistemas">Programa de Sistemas e Computação</option>
                    </select>
                </div>
            </div>

            <div class="col-md-4 d-grid gap-2">
                <a href="#" class="btn btn-outline-primary btn-lg mt-4">
                    **2. Inserir Novas Linhas de Pesquisa**
                </a>
                <small class="text-muted text-center">Incremento solicitado</small>
            </div>
        </div>

        <hr>

        <h2 class="mt-4 mb-3">3. Sugestões de Editais Apropriados (Ordenados por Relevância)</h2>

        <div class="alert alert-info" id="mensagemAguarde" role="alert">
            Selecione uma linha de pesquisa acima para carregar os editais e seus **scores de relevância (IA)**.
        </div>
        
        <div class="alert alert-warning d-none" id="alertaNotificacao" role="alert">
            <h4 class="alert-heading">Atenção!</h4>
            <p>Você está navegando **sem fazer login**. Não receberá notificações por e-mail sobre novos editais. Clique em "Fazer Login" para ativar os alertas.</p>
        </div>

        <div class="table-responsive">
            <table class="table table-striped table-hover shadow-sm" id="tabelaEditais" style="display:none;">
                <thead class="table-dark">
                    <tr>
                        <th>Edital de Fomento</th>
                        <th>Agência</th>
                        <th>Data Limite</th>
                        <th>Score de Relevância (IA)</th>
                        <th>Ação</th>
                    </tr>
                </thead>
                <tbody id="corpoTabela">
                    </tbody>
            </table>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Variável de estado para simular o login
        let usuarioLogado = false; 

        // -----------------------------------------------------
        // LÓGICA DO LOGIN
        // -----------------------------------------------------
        const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
        const usuarioInfo = document.getElementById('usuarioInfo');
        const alertaNotificacao = document.getElementById('alertaNotificacao');

        // Exibe o modal assim que a página é carregada
        window.onload = function() {
            loginModal.show();
        }

        function fazerLogin() {
            // No sistema real, você enviaria o e-mail/senha para o servidor aqui.
            const email = document.getElementById('inputEmail').value;
            
            // Simulação de login bem-sucedido
            if (email) {
                usuarioLogado = true;
                loginModal.hide();
                // Atualiza a interface para refletir o login
                usuarioInfo.innerHTML = `Bem-vindo(a), ${email} | **Notificações ATIVAS**`;
                alertaNotificacao.classList.add('d-none');
                document.getElementById('headerLoginLink').innerHTML = 'Sair'; // Altera o link para "Sair"
                alert("Login efetuado com sucesso! Você receberá alertas por e-mail.");

            } else {
                alert("Por favor, preencha o campo de e-mail.");
            }
        }

        function continuarSemLogin() {
            usuarioLogado = false;
            loginModal.hide();
            // Atualiza a interface para refletir o status
            usuarioInfo.innerHTML = `Navegando como Visitante | **Notificações INATIVAS**`;
            alertaNotificacao.classList.remove('d-none'); // Mostra o alerta
            document.getElementById('headerLoginLink').innerHTML = 'Fazer Login'; // Mantém o link para fazer login
        }
        
        // -----------------------------------------------------
        // LÓGICA DE CARREGAMENTO DE EDITAIS (MANTIDA)
        // -----------------------------------------------------
        const dadosEditais = {
            cartografica: [
                { nome: "Fomento em Geoprocessamento 2026", agencia: "CNPq", data: "01/11/2025", score: 93 },
                { nome: "Modelagem de Dados Espaciais", agencia: "FINEP", data: "15/12/2025", score: 85 },
            ],
            defesa: [
                { nome: "Pesquisa Estratégica Nacional", agencia: "MD/CNPq", data: "20/10/2025", score: 98 },
                { nome: "Tecnologias de Monitoramento", agencia: "CAPES", data: "05/11/2025", score: 90 },
            ],
            eletrica: [
                { nome: "Sistemas de Energia Inteligente", agencia: "FAPESP", data: "10/11/2025", score: 95 },
                { nome: "Eletrônica de Potência", agencia: "FINEP", data: "01/12/2025", score: 80 },
            ],
            mecanica: [
                { nome: "Desenvolvimento de Máquinas", agencia: "BNDES", data: "25/10/2025", score: 88 },
            ],
            nuclear: [
                { nome: "Segurança e Aplicações Nucleares", agencia: "CNEN", data: "15/11/2025", score: 99 },
                { nome: "Novas Fontes de Energia", agencia: "FAPERJ", data: "01/12/2025", score: 78 },
            ],
            transportes: [
                { nome: "Logística e Otimização 2025", agencia: "FINEP", data: "01/10/2025", score: 91 },
                { nome: "Fluxo e Tráfego", agencia: "CNPq", data: "01/12/2025", score: 85 },
            ],
            materiais: [
                { nome: "Pesquisa em Materiais Avançados", agencia: "FAPESP", data: "05/11/2025", score: 96 },
            ],
            quimica: [
                { nome: "Química Sustentável", agencia: "CAPES", data: "15/11/2025", score: 89 },
            ],
            sistemas: [
                { nome: "Chamada Universal CNPq 2026", agencia: "CNPq", data: "15/10/2025", score: 92 },
                { nome: "Pesquisa Básica em IA", agencia: "FAPESP", data: "20/11/2025", score: 88 },
            ]
        };

        function carregarEditais() {
            const linhaSelecionada = document.getElementById('selectLinha').value;
            const corpoTabela = document.getElementById('corpoTabela');
            const tabela = document.getElementById('tabelaEditais');
            const mensagem = document.getElementById('mensagemAguarde');
            
            corpoTabela.innerHTML = ''; 
            tabela.style.display = 'none';

            if (!linhaSelecionada) {
                mensagem.style.display = 'block';
                return;
            }

            mensagem.style.display = 'none';

            let editais = dadosEditais[linhaSelecionada] || [];

            // GARANTIR A ORDENAÇÃO POR RELEVÂNCIA (Do maior score para o menor)
            editais.sort((a, b) => b.score - a.score);

            if (editais.length === 0) {
                corpoTabela.innerHTML = '<tr><td colspan="5" class="text-center">Nenhum edital encontrado para esta linha.</td></tr>';
            } else {
                editais.forEach(edital => {
                    const corScore = edital.score >= 90 ? 'text-success fw-bold' : edital.score >= 70 ? 'text-warning fw-bold' : 'text-muted';
                    const linha = `
                        <tr>
                            <td>${edital.nome}</td>
                            <td>${edital.agencia}</td>
                            <td>${edital.data}</td>
                            <td class="${corScore}">${edital.score}%</td>
                            <td><button class="btn btn-sm btn-info">Detalhes</button></td>
                        </tr>
                    `;
                    corpoTabela.innerHTML += linha;
                });
            }
            
            tabela.style.display = 'table';
        }
    </script>
</body>
</html>